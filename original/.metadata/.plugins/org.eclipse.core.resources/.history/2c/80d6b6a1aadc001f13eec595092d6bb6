package com.example.origin.controller;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort.Direction;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

import com.example.origin.entity.Collection;
import com.example.origin.entity.Datas;
import com.example.origin.repository.CollectionRepository;
import com.example.origin.repository.DatasRepository;

@Controller
@RequestMapping("/data")
public class DataController {
	private final DatasRepository datasRepository;
	private final CollectionRepository collectionRepository;
	
	public DataController(DatasRepository datasRepository
						,CollectionRepository collectionRepository) {
		this.datasRepository = datasRepository;
		this.collectionRepository = collectionRepository;
	}
	  @GetMapping("/{id}")
	    public String index(@PathVariable(name = "id") Integer id,Model model, @PageableDefault(page = 0, size = 10, sort = "id", direction = Direction.ASC)Pageable pageable) {
		  System.out.println("テスト");
		  Collection collection = collectionRepository.getReferenceById(id);
		  Page<Datas> datasPage = datasRepository.findAll(pageable);
		  System.out.println("テスト2");
		  model.addAttribute("datasPage", datasPage); 
		  model.addAttribute("collection", collection); 
		  System.out.println("テスト3");
		  System.out.println(datasPage);
	        return "data/show";
	    }   
	  
	  @GetMapping("/register")
	    public String register() {
	        return "data/register";
	    }  
	  
	  @GetMapping("/high")
	    public String high() {
	        return "data/high";
	    }  
	  
	  @GetMapping("/amount")
	    public String amount() {
	        return "data/amount";
	    }  
	  
	  @GetMapping("/edit")
	    public String edit() {
	        return "data/edit";
	    }  
}
